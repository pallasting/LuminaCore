# **Sprint 1：架构定义与逻辑层设计**

既然你选择继续，那我们就正式进入 **Sprint 1：架构定义与逻辑层设计**。

这是整个项目的“灵魂构建”阶段。我们需要定义这颗芯片的“语言”，即：**软件如何指挥这颗光子芯片工作？**

我们将这一层命名为 **L-ISA (Lumina Instruction Set Architecture)**。它的核心挑战在于：如何把计算机懂的二进制代码（0/1），翻译成光子芯片懂的颜色和亮度（RGB/Intensity）。

以下是 **Sprint 1** 的详细设计方案：

---

### 1. 建立“逻辑-物理”映射表 (The Logic-Physics Rosetta Stone)

首先，我们需要规定不同的“光色组合”到底代表什么运算。这是硬件层面的“硬编码”。

假设我们的稀土光源阵列有三个通道（R, G, B），光栅路由器对应有三个物理出口，连接到不同的运算单元。

| 通道 (Channel) | 物理波长 (Wavelength) | 对应的计算单元 (Functional Unit) | 逻辑含义 (Logical Op) | 典型应用 |
| :--- | :--- | :--- | :--- | :--- |
| **Channel 1** | $\lambda_{Red}$ (~620nm) | **MAC Unit (Pos)** | **矩阵乘累加 (+)** | 正常的神经网络权重计算 |
| **Channel 2** | $\lambda_{Green}$ (~540nm) | **MAC Unit (Neg)** | **矩阵乘累减 (-)** | 抑制性神经元/残差连接 |
| **Channel 3** | $\lambda_{Blue}$ (~460nm) | **Non-Linear Unit** | **激活函数 (ReLU/Sigmoid)** | 非线性变换 (可选配置) |

* **设计注释：**
  * **单色模式：** 仅点亮红光 = 只做标准乘法。
  * **混色模式（并行）：** 同时点亮红光和绿光 = 同时计算正向权重和抑制权重（这在生物神经网络模拟中非常有用）。

---

### 2. 定义光子指令集 (L-ISA Definition)

我们需要一套精简指令集（RISC风格）来控制电压驱动器。

#### 2.1 基础指令格式

指令长度：32-bit
`[ OpCode (4bit) ] [ Channel_Mask (3bit) ] [ Address/Value (25bit) ]`

#### 2.2 核心指令列表

1. **`LOAD_DAC` (加载数据/权重)**
    * **功能：** 将数字权重转换为模拟电压值，预加载到 DAC（数模转换器）缓存中。
    * *物理动作：* 准备好要给稀土像素施加多少电压（决定光的亮度 = 权重大小）。

2. **`FIRE_PULSE` (激发运算)**
    * **功能：** 核心指令。根据 `Channel_Mask` 瞬间触发对应的稀土像素。
    * **参数：**
        * `001` (R): 仅执行加法。
        * `011` (R+G): 并行执行加法和减法。
        * `111` (R+G+B): 全通道全火力全开。
    * *物理动作：* 稀土像素发光 -> 光飞过光栅 -> 完成运算。

3. **`READ_ADC` (读取结果)**
    * **功能：** 触发探测器采样，将光强转回数字信号。

4. **`CONFIG_WDM` (重构光路 - 高级)**
    * **功能：** 如果芯片设计了可调光栅（热光调节），此指令用于微调波长路由（通常用于初始化校准）。

---

### 3. 数据流执行演示 (Execution Walkthrough)

为了验证这个架构是否跑得通，我们来模拟一次最简单的 AI 运算：**$y = w \cdot x + b$** （神经元加权求和）。

#### 场景设定

* 输入 $x$（来自上一层输出）：电压信号。
* 权重 $w$（正数部分）：映射到红光通道。
* 偏置 $b$（负数部分）：映射到绿光通道。

#### 执行步骤（Step-by-Step）

1. **T0 (准备阶段):**
    * 指令：`LOAD_DAC [Red_Buffer], Weight_Value` (把权重 $w$ 对应的电压值准备好)
    * 指令：`LOAD_DAC [Green_Buffer], Bias_Value` (把偏置 $b$ 对应的电压值准备好)

2. **T1 (输入激发 - The Logic Magic):**
    * 输入信号 $x$ 到达。
    * 指令：`FIRE_PULSE [Mask: 011]` (同时激发红光和绿光)。
    * **物理现象：**
        * 红光像素以亮度 $w \cdot x$ 发光。
        * 绿光像素以亮度 $b$ 发光。
        * 两束光混合成“黄光”进入波导。

3. **T2 (光速路由 - The Physics Magic):**
    * 混合光到达光栅。
    * **红光分量**被折射到“加法器”路径。
    * **绿光分量**被折射到“减法器/偏置”路径。

4. **T3 (结果汇聚):**
    * 光强在探测器处叠加。
    * 指令：`READ_ADC [Result_Reg]`。
    * **获得结果：** 这一步直接读出了计算后的数值。

---

### 4. 架构师视角的自检 (Self-Review)

在这一阶段，我们需要诚实地面对潜在的逻辑漏洞：

* **问题 A：串扰 (Crosstalk)**
  * *挑战：* 红光（620nm）会不会稍微有一点漏进绿光（540nm）的通道？
  * *解决策略：* 在指令集层面引入**“保护带（Guard Band）”**。我们选择的 RGB 波长间隔必须足够大（>50nm），且 4nm 的稀土发射峰极其窄，这从物理上保证了逻辑的纯净性。

* **问题 B：非线性实现 (Non-linearity)**
  * *挑战：* 光的叠加全是线性的（加减乘除），AI 需要非线性（ReLU）。光怎么做 ReLU？
  * *解决策略：* 这通常是光子计算的短板。我们的架构建议：**O-E-O（光-电-光）转换**。在 `READ_ADC` 之后，在电域（数字电路）里做 ReLU，然后再转换成下一次的光脉冲。虽然有转换损耗，但这是目前最稳妥的方案。

---

### 结论与下一步

**Sprint 1 任务完成：** 我们已经成功定义了这颗芯片的“大脑”（指令集）和“神经反射弧”（数据流）。这套逻辑在理论上是闭环的，且完美利用了 Nature 2025 论文中稀土材料“电驱动+窄线宽”的特性来实现并行逻辑。

**Sprint 2 预告：物理层建模 (Getting Physical)**

既然逻辑通了，下一步我们需要算一算**“代价”**。

* 这个芯片到底有多大？
* 4nm 的像素发出的光，飞过几毫米的波导后，探测器还看得见吗？（链路预算）
* 它真的比英伟达的 GPU 省电吗？（能耗估算）

准备好进入数学计算和物理建模的“深水区”了吗？
